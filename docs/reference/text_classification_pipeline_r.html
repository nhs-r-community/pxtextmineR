<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit and evaluate the pipeline — text_classification_pipeline_r • pxtextmineR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit and evaluate the pipeline — text_classification_pipeline_r" />
<meta property="og:description" content="Split the data, build and fit the pipeline, produce performance metrics." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pxtextmineR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/pxtextmineR-vignette.html">pxtextmineR-vignette</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit and evaluate the pipeline</h1>
    
    <div class="hidden name"><code>text_classification_pipeline_r.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Split the data, build and fit the pipeline, produce performance metrics.</p>
    </div>

    <pre class="usage"><span class='fu'>text_classification_pipeline_r</span><span class='op'>(</span>
  <span class='va'>filename</span>,
  <span class='va'>target</span>,
  <span class='va'>predictor</span>,
  test_size <span class='op'>=</span> <span class='fl'>0.33</span>,
  ordinal <span class='op'>=</span> <span class='cn'>FALSE</span>,
  tknz <span class='op'>=</span> <span class='st'>"spacy"</span>,
  metric <span class='op'>=</span> <span class='st'>"class_balance_accuracy_score"</span>,
  cv <span class='op'>=</span> <span class='fl'>2</span>,
  n_iter <span class='op'>=</span> <span class='fl'>10</span>,
  n_jobs <span class='op'>=</span> <span class='fl'>1</span>,
  verbose <span class='op'>=</span> <span class='fl'>3</span>,
  learners <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SGDClassifier"</span><span class='op'>)</span>,
  reduce_criticality <span class='op'>=</span> <span class='cn'>FALSE</span>,
  theme <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>filename</th>
      <td><p>A data frame with the data (class and text columns),
otherwise the dataset name (CSV), including full path to the data folder
(if not in the project's working directory), and the data type suffix
(".csv").</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>String. The name of the response variable.</p></td>
    </tr>
    <tr>
      <th>predictor</th>
      <td><p>String. The name of the predictor variable.</p></td>
    </tr>
    <tr>
      <th>test_size</th>
      <td><p>Numeric. Proportion of data that will form the test dataset.</p></td>
    </tr>
    <tr>
      <th>ordinal</th>
      <td><p>Whether to fit an ordinal classification model. The ordinal
model is the implementation of <a href='https://www.cs.waikato.ac.nz/~eibe/pubs/ordinal_tech_report.pdf'>Frank and Hall (2001)</a>
that can use any standard classification model that calculates
probabilities.</p></td>
    </tr>
    <tr>
      <th>tknz</th>
      <td><p>Tokenizer to use ("spacy" or "wordnet").</p></td>
    </tr>
    <tr>
      <th>metric</th>
      <td><p>String. Scorer to use during pipeline tuning
("accuracy_score", "balanced_accuracy_score", "matthews_corrcoef",
"class_balance_accuracy_score").</p></td>
    </tr>
    <tr>
      <th>cv</th>
      <td><p>Number of cross-validation folds.</p></td>
    </tr>
    <tr>
      <th>n_iter</th>
      <td><p>Number of parameter settings that are sampled (see
<a href='https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html'><code>sklearn.model_selection.RandomizedSearchCV</code></a>).</p></td>
    </tr>
    <tr>
      <th>n_jobs</th>
      <td><p>Number of jobs to run in parallel (see <code>sklearn.model_selection.RandomizedSearchCV</code>).
<strong>NOTE:</strong> If your machine does not have the number of cores specified in
<code>n_jobs</code>, then an error will be returned.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Controls the verbosity (see <code>sklearn.model_selection.RandomizedSearchCV</code>).</p></td>
    </tr>
    <tr>
      <th>learners</th>
      <td><p>Vector. <code>Scikit-learn</code> names of the learners to tune. Must
be one or more of "SGDClassifier", "RidgeClassifier", "Perceptron",
"PassiveAggressiveClassifier", "BernoulliNB", "ComplementNB",
"MultinomialNB", "KNeighborsClassifier", "NearestCentroid",
"RandomForestClassifier". When a single model is used, it can be passed as
a string.</p></td>
    </tr>
    <tr>
      <th>reduce_criticality</th>
      <td><p>Logical. For internal use by Nottinghamshire
Healthcare NHS Foundation Trust or other trusts that hold data on
criticality. If <code>TRUE</code>, then all records with a criticality of "-5"
(respectively, "5") are assigned a criticality of "-4" (respectively, "4").
This is to avoid situations where the pipeline breaks due to a lack of
sufficient data for "-5" and/or "5". Defaults to <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>theme</th>
      <td><p>String. For internal use by Nottinghamshire Healthcare NHS
Foundation Trust or other trusts that use theme labels ("Access",
"Environment/ facilities" etc.). The column name of the theme variable.
Defaults to <code>NULL</code>. If supplied, the theme variable will be used as a
predictor (along with the text predictor) in the model that is fitted
with criticality as the response variable. The rationale is two-fold.
First, to help the model improve predictions on criticality when the
theme labels are readily available. Second, to force the criticality for
"Couldn't be improved" to always be "3" in the training and test data, as
well as in the predictions. This is the only criticality value that
"Couldn't be improved" can take, so by forcing it to always be "3", we
are improving model performance, but are also correcting possible
erroneous assignments of values other than "3" that are attributed to
human error.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of length 7:</p><ul>
<li><p>A fitted <code>Scikit-learn</code> pipeline containing a number of objects
that can be accessed with the <code><a href='https://rdrr.io/r/base/Extract.html'>$</a></code> sign (see examples). For a
partial list see "Atributes" in
<a href='https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html'><code>sklearn.model_selection.RandomizedSearchCV</code></a>.
Do not be surprised if more objects are in the pipeline than
those in the aforementioned "Attributes" list. Python objects can
contain several objects, from numeric results (e.g. the
pipeline's accuracy), to <em>methods</em> (i.e. functions in the R
lingo) and <em>classes</em>. In Python, these are normally accessed with
<code>object.&lt;whatever&gt;</code>, but in R the command is <code>object$&lt;whatever&gt;</code>.
For instance, one can access method <code><a href='https://rdrr.io/r/stats/predict.html'>predict()</a></code> to make  to make
predictions on unseen data. See Examples.</p></li>
<li><p><code>tuning_results</code> Data frame. All (hyper)parameter values
and models tried during fitting.</p></li>
<li><p><code>pred</code> Vector. The predictions on the test set.</p></li>
<li><p><code>accuracy_per_class</code> Data frame. Accuracies per class.</p></li>
<li><p><code>p_compare_models_bar</code> A bar plot comparing the mean scores (of
the user-supplied <code>metric</code> parameter) from the cross-validation
on the training set, for the best (hyper)parameter values for
each learner.</p></li>
<li><p><code>index_training_data</code> The row names/indices of the training
data. Note that, in Python, indices start from 0 and go up to
number_of_records - 1. See Examples.</p></li>
<li><p><code>index_test_data</code> The row names/indices of the test data. Note
that, in Python, indices start from 0 and go up to
number_of_records - 1. See Examples.</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function brings together the three functions that run chunks of
the process independently, namely splitting data into training and test
sets (<code><a href='factory_data_load_and_split_r.html'>factory_data_load_and_split_r</a></code>), building and fitting
the pipeline (<code><a href='factory_pipeline_r.html'>factory_pipeline_r</a></code>) on the <strong>whole</strong> dataset
(train and test), and assessing pipeline performance
(<code><a href='factory_model_performance_r.html'>factory_model_performance_r</a></code>). <br /><br />
For details on what the pipeline does/how it works, see
<code><a href='factory_pipeline_r.html'>factory_pipeline_r</a></code>'s
<a href='https://nhs-r-community.github.io/pxtextmineR/reference/factory_pipeline_r.html#details'>Details</a>
section.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Frank E. &amp; Hall M. (2001). A Simple Approach to Ordinal Classification.
<em>Machine Learning: ECML 2001</em> 145--156.</p>
<p>Pedregosa F., Varoquaux G., Gramfort A., Michel V., Thirion B., Grisel O.,
Blondel M., Prettenhofer P., Weiss R., Dubourg V., Vanderplas J., Passos A.,
Cournapeau D., Brucher M., Perrot M. &amp; Duchesnay E. (2011),
<a href='https://jmlr.csail.mit.edu/papers/v12/pedregosa11a.html'>Scikit-learn: Machine Learning in Python</a>.
<em>Journal of Machine Learning Research</em> 12:2825–-2830.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># We can prepare the data, build and fit the pipeline, and get performance</span>
<span class='co'># metrics, in two ways. One way is to run the factory_* functions independently</span>
<span class='co'># The commented out script right below would do exactly that.</span>

<span class='co'># Prepare training and test sets</span>
<span class='co'># data_splits &lt;- pxtextmineR::factory_data_load_and_split_r(</span>
<span class='co'>#   filename = pxtextmineR::text_data,</span>
<span class='co'>#   target = "label",</span>
<span class='co'>#   predictor = "feedback",</span>
<span class='co'>#   test_size = 0.90) # Make a small training set for a faster run in this example</span>
<span class='co'>#</span>
<span class='co'># # Fit the pipeline</span>
<span class='co'># pipe &lt;- pxtextmineR::factory_pipeline_r(</span>
<span class='co'>#   x = data_splits$x_train,</span>
<span class='co'>#   y = data_splits$y_train,</span>
<span class='co'>#   tknz = "spacy",</span>
<span class='co'>#   ordinal = FALSE,</span>
<span class='co'>#   metric = "class_balance_accuracy_score",</span>
<span class='co'>#   cv = 2, n_iter = 10, n_jobs = 1, verbose = 3,</span>
<span class='co'>#   learners = c("SGDClassifier", "MultinomialNB")</span>
<span class='co'># )</span>
<span class='co'># (SGDClassifier represents both logistic regression and linear SVM. This</span>
<span class='co'># depends on the value of the "loss" hyperparameter, which can be "log" or</span>
<span class='co'># "hinge". This is set internally in factory_pipeline_r).</span>
<span class='co'>#</span>
<span class='co'># # Assess model performance</span>
<span class='co'># pipe_performance &lt;- pxtextmineR::factory_model_performance_r(</span>
<span class='co'>#   pipe = pipe,</span>
<span class='co'>#   x_train = data_splits$x_train,</span>
<span class='co'>#   y_train = data_splits$y_train,</span>
<span class='co'>#   x_test = data_splits$x_test,</span>
<span class='co'>#   y_test = data_splits$y_test,</span>
<span class='co'>#   metric = "accuracy_score")</span>

<span class='co'># Alternatively, we can use text_classification_pipeline_r() to do everything in</span>
<span class='co'># one go.</span>
<span class='va'>text_pipe</span> <span class='op'>&lt;-</span> <span class='fu'>pxtextmineR</span><span class='fu'>::</span><span class='fu'>text_classification_pipeline_r</span><span class='op'>(</span>
  filename <span class='op'>=</span> <span class='fu'>pxtextmineR</span><span class='fu'>::</span><span class='va'><a href='text_data.html'>text_data</a></span>,
  target <span class='op'>=</span> <span class='st'>'label'</span>,
  predictor <span class='op'>=</span> <span class='st'>'feedback'</span>,
  test_size <span class='op'>=</span> <span class='fl'>0.33</span>,
  ordinal <span class='op'>=</span> <span class='cn'>FALSE</span>,
  tknz <span class='op'>=</span> <span class='st'>"spacy"</span>,
  metric <span class='op'>=</span> <span class='st'>"class_balance_accuracy_score"</span>,
  cv <span class='op'>=</span> <span class='fl'>2</span>, n_iter <span class='op'>=</span> <span class='fl'>10</span>, n_jobs <span class='op'>=</span> <span class='fl'>1</span>, verbose <span class='op'>=</span> <span class='fl'>3</span>,
  learners <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SGDClassifier"</span>, <span class='st'>"MultinomialNB"</span><span class='op'>)</span>,
  reduce_criticality <span class='op'>=</span> <span class='cn'>FALSE</span>,
  theme <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>text_pipe</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "pipe"                 "tuning_results"       "pred"                
#&gt; [4] "accuracy_per_class"   "p_compare_models_bar" "index_training_data" 
#&gt; [7] "index_test_data"     </div><div class='input'>
<span class='co'># Let's compare pipeline performance for different tunings with a range of</span>
<span class='co'># metrics averaging the cross-validation metrics for each fold.</span>
<span class='va'>text_pipe</span><span class='op'>$</span>
  <span class='va'>tuning_results</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>learner</span>, <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>contains</a></span><span class='op'>(</span><span class='st'>"mean_test"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;         learner mean_test_Accuracy mean_test_Balanced Accuracy
#&gt; 2      Logistic          0.6692195                   0.4642124
#&gt; 0    Linear SVM          0.5575606                   0.4020137
#&gt; 6      Logistic          0.5090311                   0.3634837
#&gt; 5    Linear SVM          0.5855842                   0.3474347
#&gt; 8 MultinomialNB          0.4810045                   0.3219231
#&gt; 9    Linear SVM          0.4170098                   0.3080414
#&gt; 1 MultinomialNB          0.4805708                   0.2927007
#&gt; 4 MultinomialNB          0.5646388                   0.2881532
#&gt; 7      Logistic          0.4552871                   0.2632449
#&gt; 3      Logistic          0.4135429                   0.2520484
#&gt;   mean_test_Matthews Correlation Coefficient mean_test_Class Balance Accuracy
#&gt; 2                                  0.5679886                        0.4312644
#&gt; 0                                  0.4386832                        0.3549740
#&gt; 6                                  0.3785785                        0.3066306
#&gt; 5                                  0.4573056                        0.3014037
#&gt; 8                                  0.3360435                        0.2718537
#&gt; 9                                  0.2858717                        0.2535001
#&gt; 1                                  0.3198254                        0.2445776
#&gt; 4                                  0.4183560                        0.2346988
#&gt; 7                                  0.2877204                        0.2207833
#&gt; 3                                  0.2491383                        0.1815914</div><div class='input'>
<span class='co'># A glance at the (hyper)parameters and their tuned values</span>
<span class='va'>text_pipe</span><span class='op'>$</span>
  <span class='va'>tuning_results</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>learner</span>, <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>contains</a></span><span class='op'>(</span><span class='st'>"param_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 'data.frame':	10 obs. of  22 variables:
#&gt;  $ learner                                                    : chr  "Logistic" "Linear SVM" "Logistic" "Linear SVM" ...
#&gt;  $ param_sampling__kw_args                                    : chr  "{'up_balancing_counts': 800}" "{'up_balancing_counts': 300}" "{'up_balancing_counts': 800}" "{'up_balancing_counts': 800}" ...
#&gt;  $ param_preprocessor__texttr__text__transformer__use_idf     :List of 10
#&gt;   ..$ : logi FALSE
#&gt;   ..$ : logi FALSE
#&gt;   ..$ : logi FALSE
#&gt;   ..$ : logi FALSE
#&gt;   ..$ : logi TRUE
#&gt;   ..$ : logi TRUE
#&gt;   ..$ : logi TRUE
#&gt;   ..$ : logi FALSE
#&gt;   ..$ : logi FALSE
#&gt;   ..$ : logi TRUE
#&gt;  $ param_preprocessor__texttr__text__transformer__tokenizer   : chr  "&lt;pxtextmining.helpers.tokenization.LemmaTokenizer object at 0x0000000016D661C0&gt;" "&lt;pxtextmining.helpers.tokenization.LemmaTokenizer object at 0x0000000016D661C0&gt;" "&lt;pxtextmining.helpers.tokenization.LemmaTokenizer object at 0x0000000016D661C0&gt;" "&lt;pxtextmining.helpers.tokenization.LemmaTokenizer object at 0x0000000016D661C0&gt;" ...
#&gt;  $ param_preprocessor__texttr__text__transformer__preprocessor: chr  "&lt;function text_preprocessor at 0x00000000665D93A0&gt;" "&lt;function text_preprocessor at 0x00000000665D93A0&gt;" "&lt;function text_preprocessor at 0x00000000665D93A0&gt;" "&lt;function text_preprocessor at 0x00000000665D93A0&gt;" ...
#&gt;  $ param_preprocessor__texttr__text__transformer__norm        :List of 10
#&gt;   ..$ : NULL
#&gt;   ..$ : chr "l2"
#&gt;   ..$ : chr "l2"
#&gt;   ..$ : NULL
#&gt;   ..$ : chr "l2"
#&gt;   ..$ : chr "l2"
#&gt;   ..$ : chr "l2"
#&gt;   ..$ : NULL
#&gt;   ..$ : NULL
#&gt;   ..$ : chr "l2"
#&gt;  $ param_preprocessor__texttr__text__transformer__ngram_range : chr  "(1, 3)" "(2, 3)" "(2, 3)" "(2, 3)" ...
#&gt;  $ param_preprocessor__texttr__text__transformer__min_df      :List of 10
#&gt;   ..$ : int 1
#&gt;   ..$ : int 3
#&gt;   ..$ : int 1
#&gt;   ..$ : int 1
#&gt;   ..$ : int 3
#&gt;   ..$ : int 3
#&gt;   ..$ : int 3
#&gt;   ..$ : int 3
#&gt;   ..$ : int 3
#&gt;   ..$ : int 3
#&gt;  $ param_preprocessor__texttr__text__transformer__max_df      :List of 10
#&gt;   ..$ : num 0.95
#&gt;   ..$ : num 0.7
#&gt;   ..$ : num 0.95
#&gt;   ..$ : num 0.95
#&gt;   ..$ : num 0.95
#&gt;   ..$ : num 0.7
#&gt;   ..$ : num 0.7
#&gt;   ..$ : num 0.7
#&gt;   ..$ : num 0.7
#&gt;   ..$ : num 0.7
#&gt;  $ param_preprocessor__texttr__text__transformer              : chr  "TfidfVectorizer(max_df=0.95, ngram_range=(1, 3), norm=None,\n                preprocessor=&lt;function text_prepro"| __truncated__ "TfidfVectorizer(max_df=0.95, ngram_range=(1, 3), norm=None,\n                preprocessor=&lt;function text_prepro"| __truncated__ "TfidfVectorizer(max_df=0.95, ngram_range=(1, 3), norm=None,\n                preprocessor=&lt;function text_prepro"| __truncated__ "TfidfVectorizer(max_df=0.95, ngram_range=(1, 3), norm=None,\n                preprocessor=&lt;function text_prepro"| __truncated__ ...
#&gt;  $ param_preprocessor__sentimenttr__scaler__scaler__n_bins    :List of 10
#&gt;   ..$ : int 4
#&gt;   ..$ : int 4
#&gt;   ..$ : int 4
#&gt;   ..$ : int 4
#&gt;   ..$ : int 8
#&gt;   ..$ : int 8
#&gt;   ..$ : int 4
#&gt;   ..$ : int 4
#&gt;   ..$ : int 8
#&gt;   ..$ : int 4
#&gt;  $ param_preprocessor__sentimenttr__scaler__scaler            : chr  "KBinsDiscretizer(n_bins=4, strategy='kmeans')" "KBinsDiscretizer(n_bins=4, strategy='kmeans')" "KBinsDiscretizer(n_bins=4, strategy='kmeans')" "KBinsDiscretizer(n_bins=4, strategy='kmeans')" ...
#&gt;  $ param_preprocessor__lengthtr__scaler__scaler               : chr  "KBinsDiscretizer(n_bins=3, strategy='kmeans')" "KBinsDiscretizer(n_bins=3, strategy='kmeans')" "KBinsDiscretizer(n_bins=3, strategy='kmeans')" "KBinsDiscretizer(n_bins=3, strategy='kmeans')" ...
#&gt;  $ param_featsel__selector__score_func                        : chr  "&lt;function chi2 at 0x00000000665C14C0&gt;" "&lt;function chi2 at 0x00000000665C14C0&gt;" "&lt;function chi2 at 0x00000000665C14C0&gt;" "&lt;function chi2 at 0x00000000665C14C0&gt;" ...
#&gt;  $ param_featsel__selector__percentile                        :List of 10
#&gt;   ..$ : int 70
#&gt;   ..$ : int 70
#&gt;   ..$ : int 85
#&gt;   ..$ : int 70
#&gt;   ..$ : int 85
#&gt;   ..$ : int 85
#&gt;   ..$ : int 100
#&gt;   ..$ : int 100
#&gt;   ..$ : int 85
#&gt;   ..$ : int 85
#&gt;  $ param_featsel__selector                                    : chr  "SelectPercentile(percentile=70,\n                 score_func=&lt;function chi2 at 0x00000000665C14C0&gt;)" "SelectPercentile(percentile=70,\n                 score_func=&lt;function chi2 at 0x00000000665C14C0&gt;)" "SelectPercentile(percentile=70,\n                 score_func=&lt;function chi2 at 0x00000000665C14C0&gt;)" "SelectPercentile(percentile=70,\n                 score_func=&lt;function chi2 at 0x00000000665C14C0&gt;)" ...
#&gt;  $ param_clf__estimator__penalty                              :List of 10
#&gt;   ..$ : chr "elasticnet"
#&gt;   ..$ : chr "l2"
#&gt;   ..$ : chr "elasticnet"
#&gt;   ..$ : chr "l2"
#&gt;   ..$ : num NaN
#&gt;   ..$ : chr "elasticnet"
#&gt;   ..$ : num NaN
#&gt;   ..$ : num NaN
#&gt;   ..$ : chr "elasticnet"
#&gt;   ..$ : chr "l2"
#&gt;  $ param_clf__estimator__max_iter                             :List of 10
#&gt;   ..$ : int 10000
#&gt;   ..$ : int 10000
#&gt;   ..$ : int 10000
#&gt;   ..$ : int 10000
#&gt;   ..$ : num NaN
#&gt;   ..$ : int 10000
#&gt;   ..$ : num NaN
#&gt;   ..$ : num NaN
#&gt;   ..$ : int 10000
#&gt;   ..$ : int 10000
#&gt;  $ param_clf__estimator__loss                                 :List of 10
#&gt;   ..$ : chr "log"
#&gt;   ..$ : chr "hinge"
#&gt;   ..$ : chr "log"
#&gt;   ..$ : chr "hinge"
#&gt;   ..$ : num NaN
#&gt;   ..$ : chr "hinge"
#&gt;   ..$ : num NaN
#&gt;   ..$ : num NaN
#&gt;   ..$ : chr "log"
#&gt;   ..$ : chr "log"
#&gt;  $ param_clf__estimator__class_weight                         :List of 10
#&gt;   ..$ : chr "balanced"
#&gt;   ..$ : chr "balanced"
#&gt;   ..$ : chr "balanced"
#&gt;   ..$ : chr "balanced"
#&gt;   ..$ : num NaN
#&gt;   ..$ : chr "balanced"
#&gt;   ..$ : num NaN
#&gt;   ..$ : num NaN
#&gt;   ..$ : NULL
#&gt;   ..$ : NULL
#&gt;  $ param_clf__estimator                                       : chr  "SGDClassifier(class_weight='balanced', loss='log', max_iter=10000,\n              penalty='elasticnet')" "SGDClassifier(class_weight='balanced', loss='log', max_iter=10000,\n              penalty='elasticnet')" "SGDClassifier(class_weight='balanced', loss='log', max_iter=10000,\n              penalty='elasticnet')" "SGDClassifier(class_weight='balanced', loss='log', max_iter=10000,\n              penalty='elasticnet')" ...
#&gt;  $ param_clf__estimator__alpha                                :List of 10
#&gt;   ..$ : num NaN
#&gt;   ..$ : num NaN
#&gt;   ..$ : num NaN
#&gt;   ..$ : num NaN
#&gt;   ..$ : num 0.1
#&gt;   ..$ : num NaN
#&gt;   ..$ : num 0.5
#&gt;   ..$ : int 1
#&gt;   ..$ : num NaN
#&gt;   ..$ : num NaN
#&gt;  - attr(*, "pandas.index")=Int64Index([2, 0, 6, 5, 8, 9, 1, 4, 7, 3], dtype='int64')</div><div class='input'>
<span class='co'># Learner performance barplot</span>
<span class='va'>text_pipe</span><span class='op'>$</span><span class='va'>p_compare_models_bar</span>
</div><div class='img'><img src='text_classification_pipeline_r-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Predictions on test set</span>
<span class='va'>preds</span> <span class='op'>&lt;-</span> <span class='va'>text_pipe</span><span class='op'>$</span><span class='va'>pred</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>preds</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "Care received"        "Care received"        "Couldn't be improved"
#&gt; [4] "Staff"                "Care received"        "Staff"               </div><div class='input'>
<span class='co'># We can also get the row indices of the train and test data. Note that, in</span>
<span class='co'># Python, indices start from 0. For example, the row indices of a data frame</span>
<span class='co'># with 5 rows would be 0, 1, 2, 3 &amp; 4.</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='va'>text_pipe</span><span class='op'>$</span><span class='va'>index_training_data</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0 1 2 3 4 5</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='va'>text_pipe</span><span class='op'>$</span><span class='va'>index_test_data</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1]  7 11 12 19 23 26</div><div class='input'>
<span class='co'># Let's subset the original data set</span>
<span class='va'>text_dataset</span> <span class='op'>&lt;-</span> <span class='fu'>pxtextmineR</span><span class='fu'>::</span><span class='va'><a href='text_data.html'>text_data</a></span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>text_dataset</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>0</span><span class='op'>:</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>text_dataset</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>data_train</span> <span class='op'>&lt;-</span> <span class='va'>text_dataset</span><span class='op'>[</span><span class='va'>text_pipe</span><span class='op'>$</span><span class='va'>index_training_data</span>, <span class='op'>]</span>
<span class='va'>data_test</span> <span class='op'>&lt;-</span> <span class='va'>text_dataset</span><span class='op'>[</span><span class='va'>text_pipe</span><span class='op'>$</span><span class='va'>index_test_data</span>, <span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>data_train</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 'data.frame':	6922 obs. of  3 variables:
#&gt;  $ label      : chr  "Staff" "Care received" "Communication" "Couldn't be improved" ...
#&gt;  $ criticality: chr  "1" "0" "0" "3" ...
#&gt;  $ feedback   : chr  "It’s because that doctors, nurses help me" "What was very good was the fact the Physiotherapist called to see my mother when she was in the area just to se"| __truncated__ "XXXX was a good listener." "Nothing" ...</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>data_test</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 'data.frame':	3411 obs. of  3 variables:
#&gt;  $ label      : chr  "Communication" "Care received" "Couldn't be improved" "Staff" ...
#&gt;  $ criticality: chr  "0" "0" "3" "0" ...
#&gt;  $ feedback   : chr  "Patient, listened carefully and very helpful advice.  Positive advice and exercises to do.\n" "I found the service very beneficial." "No, I was very with it all." "I find the staff welcoming and caring, making me feel more comfortable in discussing things." ...</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Andreas D Soteriades.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


